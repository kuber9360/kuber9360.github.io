import{_ as s,c as i,o as a,V as n}from"./chunks/framework.--NMbU3Q.js";const e="/assets/https证书生成过程.qfilM-vo.png",y=JSON.parse('{"title":"1.https证书生成过程","description":"","frontmatter":{},"headers":[],"relativePath":"articles/生成https证书.md","filePath":"articles/生成https证书.md"}'),l={name:"articles/生成https证书.md"},t=n('<h1 id="_1-https证书生成过程" tabindex="-1">1.https证书生成过程 <a class="header-anchor" href="#_1-https证书生成过程" aria-label="Permalink to &quot;1.https证书生成过程&quot;">​</a></h1><p><img src="'+e+`" alt=""></p><ul><li><p>一些概念</p></li><li><p>PKI：Public Key Infrastructure 公钥基础设施，一种遵循既定标准的密钥管理平台,它能够为所有网络应用提供加密和数字签名等密码服务及所必需的密钥和证书管理体系，简单来说，PKI就是利用公钥理论和技术建立的提供安全服务的基础设施。PKI技术是信息安全技术的核心，也是电子商务的关键和基础技术。PKI的基础技术包括加密、数字签名、数据完整性机制、数字信封、双重数字签名等。</p></li><li><p>CA：Certificate Authority，签证机构</p></li><li><p>RA：Register Authority，注册机构</p></li><li><p>CRL：Certificate Revoke Lists，证书吊销列表</p></li><li><p>X.509：定义了证书的结构和认证协议的标准。包括版本号、序列号、签名算法、颁发者、有效期限、主体名称、主体公钥、CRL分发点、扩展信息、发行者签名等</p></li><li><p>获取证书的两种方法</p><ol><li>证书授权机构颁发</li><li>自建CA颁发机构-&gt;自签名</li></ol></li></ul><h1 id="_2-自建ca颁发机构" tabindex="-1">2.自建CA颁发机构 <a class="header-anchor" href="#_2-自建ca颁发机构" aria-label="Permalink to &quot;2.自建CA颁发机构&quot;">​</a></h1><h2 id="_2-1-修改配置文件" tabindex="-1">2.1 修改配置文件 <a class="header-anchor" href="#_2-1-修改配置文件" aria-label="Permalink to &quot;2.1 修改配置文件&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/pki/tls/openssl.cnf</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">####################################################################</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ ca ]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">default_ca</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  = CA_default        # The default ca section</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">默认的CA配置，是CA_default,下面第一个小节就是</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">####################################################################</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ CA_default ]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     = /etc/pki/CA       # Where everything is kept （dir变量）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">certs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       = </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/certs       # Where the issued certs are kept（认证证书目录）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">crl_dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     = </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/crl     # Where the issued crl are kept（注销证书目录）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">database</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    = </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/index.txt   # database index file.（数据库索引文件）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">new_certs_dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   = </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/newcerts        # default place for new certs.（新证书的默认位置）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">certificate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> = </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/cacert.pem  # The CA certificate（CA机构证书）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">serial</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      = </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/serial      # The current serial number（当前序号，默认为空，可以指定从01开始）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">crlnumber</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   = </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/crlnumber   # the current crl number（下一个吊销证书序号）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                    # must be commented out to leave a V1 CRL</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">crl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     = </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/crl.pem         # The current CRL（下一个吊销证书）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">private_key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> = </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/private/cakey.pem# The private key（CA机构的私钥）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">RANDFILE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    = </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/private/.rand   # private random number file（随机数文件）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">x509_extensions</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> = usr_cert      # The extentions to add to the cert</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Comment out the following two lines for the &quot;traditional&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># (and highly broken) format.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">name_opt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    = ca_default        # Subject Name options（被颁发者，订阅者选项）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cert_opt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    = ca_default        # Certificate field options（认证字段参数）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Extension copying option: use with caution.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># copy_extensions = copy</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Extensions to add to a CRL. Note: Netscape communicator chokes on V2 CRLs</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># so this is commented out by default to leave a V1 CRL.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># crlnumber must also be commented out to leave a V1 CRL.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># crl_extensions    = crl_ext</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">default_days</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">365</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           # how long to certify for （默认的有效期天数是365）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">default_crl_days</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 30</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # how long before next CRL</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">default_md</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  = sha256        # use SHA-256 by default</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">preserve</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    = no            # keep passed DN ordering</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># A few difference way of specifying how similar the request should look</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># For type CA, the listed attributes must be the same, and the optional</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># and supplied fields are just that :-)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">policy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      = policy_match  # 是否匹配规则</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># For the CA policy</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ policy_match ]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">countryName</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     = match   # 国家名是否匹配，match为匹配</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stateOrProvinceName</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> = optional  # 州或省名是否需要匹配</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">organizationName</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    = optional  # 组织名是否需要匹配</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">organizationalUnitName</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  = optional # 组织的部门名字是否需要匹配</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">commonName</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      = supplied # 注释</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">emailAddress</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        = optional # 邮箱地址</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># For the &#39;anything&#39; policy</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># At this point in time, you must list all acceptable &#39;object&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># types.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ policy_anything ]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">countryName</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     = optional</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stateOrProvinceName</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> = optional</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">localityName</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        = optional</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">organizationName</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    = optional</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">organizationalUnitName</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  = optional</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">commonName</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      = supplied</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">emailAddress</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        = optional</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">####################################################################</span></span></code></pre></div><p>重点关注下面的几个参数：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">             = /etc/pki/CA           # Where everything is kept （dir变量）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">certs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           = </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/certs            # Where the issued certs are kept（认证证书目录）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">database</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        = </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/index.txt        # database index file.（数据库索引文件）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">new_certs_dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   = </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/newcerts         # default place for new certs.（新证书的默认位置）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">certificate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     = </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/cacert.pem       # The CA certificate（CA机构证书）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">serial</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          = </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/serial           # The current serial number（当前序号，默认为空，可以指定从01开始）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">private_key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     = </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/private/cakey.pem# The private key（CA机构的私钥）</span></span></code></pre></div><h2 id="_2-2-创建所需要的文件" tabindex="-1">2.2 创建所需要的文件 <a class="header-anchor" href="#_2-2-创建所需要的文件" aria-label="Permalink to &quot;2.2 创建所需要的文件&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/pki/CA/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">touch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> index.txt  #生成证书索引数据库文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">touch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> serial  # 指定第一个颁发证书的序列号,16进制数，比如可以从1a开始，一般从01开始。</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 01</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/pki/CA/serial</span></span></code></pre></div><h2 id="_2-3-生成ca证书" tabindex="-1">2.3 生成CA证书 <a class="header-anchor" href="#_2-3-生成ca证书" aria-label="Permalink to &quot;2.3 生成CA证书&quot;">​</a></h2><h3 id="_2-3-1-生成私钥" tabindex="-1">2.3.1 生成私钥 <a class="header-anchor" href="#_2-3-1-生成私钥" aria-label="Permalink to &quot;2.3.1 生成私钥&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> genrsa -out /etc/pki/CA/private/cakey.pem </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2048</span></span></code></pre></div><h3 id="_2-3-2-生成自签名ca证书" tabindex="-1">2.3.2 生成自签名CA证书 <a class="header-anchor" href="#_2-3-2-生成自签名ca证书" aria-label="Permalink to &quot;2.3.2 生成自签名CA证书&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> req -new -x509  -key /etc/pki/CA/private/cakey.pem  -days </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3650</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -out /etc/pki/CA/cacert.pem</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">You</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> are about to be asked to enter information that will be incorporated</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">into</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> your certificate request.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">What</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> you are about to enter is what is called a Distinguished Name or a DN.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">There</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> are quite a few fields but you can leave some blank</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">For</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> some fields there will be a default value,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">If</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> you enter &#39;.&#39;, the field will be left blank.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-----</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Country</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> letter code</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) [XX]:CN</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">State</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> or Province Name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">full</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) []:BEIJING</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Locality</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eg,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> city</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) [Default </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">City]:BEIJING</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Organization</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eg,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> company</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) [Default </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Company Ltd]:CA</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Organizational</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Unit Name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eg,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> section</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) []:OPT</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Common</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eg,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> your name or your server&#39;s hostname) []:ca.rancho.com</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Email Address []:planet1991@163.com</span></span></code></pre></div><h3 id="_2-3-4-将ca证书安装至客户端-用户" tabindex="-1">2.3.4 将CA证书安装至客户端 用户 <a class="header-anchor" href="#_2-3-4-将ca证书安装至客户端-用户" aria-label="Permalink to &quot;2.3.4 将CA证书安装至客户端 用户&quot;">​</a></h3><h4 id="_2-3-4-1-windows系统" tabindex="-1">2.3.4.1 windows系统 <a class="header-anchor" href="#_2-3-4-1-windows系统" aria-label="Permalink to &quot;2.3.4.1 windows系统&quot;">​</a></h4><p>浏览器-&gt;设置-&gt;管理证书-&gt;受信任的根证书颁发机构-&gt;导入</p><p>![3](.\\images\\Openssl SAN证书\\3.png)</p><h4 id="_2-3-4-2-linux系统-centos" tabindex="-1">2.3.4.2 linux系统-centos <a class="header-anchor" href="#_2-3-4-2-linux系统-centos" aria-label="Permalink to &quot;2.3.4.2 linux系统-centos&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cacert.pem /etc/pki/ca-trust/source/anchors</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">update-ca-trust</span></span></code></pre></div><h1 id="_3-颁发证书" tabindex="-1">3.颁发证书 <a class="header-anchor" href="#_3-颁发证书" aria-label="Permalink to &quot;3.颁发证书&quot;">​</a></h1><h2 id="_3-1-生成私钥" tabindex="-1">3.1 生成私钥 <a class="header-anchor" href="#_3-1-生成私钥" aria-label="Permalink to &quot;3.1  生成私钥&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&amp;&amp; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> genrsa -out server.key </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2048</span></span></code></pre></div><h2 id="_3-2-生成证书请求" tabindex="-1">3.2 生成证书请求 <a class="header-anchor" href="#_3-2-生成证书请求" aria-label="Permalink to &quot;3.2 生成证书请求&quot;">​</a></h2><h3 id="_3-2-1-普通证书请求" tabindex="-1">3.2.1 普通证书请求 <a class="header-anchor" href="#_3-2-1-普通证书请求" aria-label="Permalink to &quot;3.2.1 普通证书请求&quot;">​</a></h3><p>注意go1.5 已废弃，<a href="https://go.dev/doc/go1.15#commonname" target="_blank" rel="noreferrer">https://go.dev/doc/go1.15#commonname</a></p><ul><li><p>The deprecated, legacy behavior of treating the <code>CommonName</code> field on X.509 certificates as a host name when no Subject Alternative Names are present is now disabled by default. It can be temporarily re-enabled by adding the value <code>x509ignoreCN=0</code> to the <code>GODEBUG</code> environment variable.</p><p>Note that if the <code>CommonName</code> is an invalid host name, it&#39;s always ignored, regardless of <code>GODEBUG</code> settings. Invalid names include those with any characters other than letters, digits, hyphens and underscores, and those with empty labels or trailing dots.</p></li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> req -new -key server.key -days </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3650</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -out server.csr</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">You</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> are about to be asked to enter information that will be incorporated</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">into</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> your certificate request.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">What</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> you are about to enter is what is called a Distinguished Name or a DN.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">There</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> are quite a few fields but you can leave some blank</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">For</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> some fields there will be a default value,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">If</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> you enter &#39;.&#39;, the field will be left blank.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-----</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Country</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> letter code</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) [XX]:CN</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">State</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> or Province Name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">full</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) []:BEIJING</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Locality</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eg,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> city</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) [Default </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">City]:BEIJING</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Organization</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eg,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> company</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) [Default </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Company Ltd]:CC</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Organizational</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Unit Name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eg,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> section</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) []:OPT</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Common</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eg,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> your name or your server&#39;s hostname) []:hub.kuber.com</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Email Address []:planet1991@163.com</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Please enter the following &#39;extra&#39; attributes</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">to be sent with your certificate request</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">A challenge password []:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">An optional company name []:		//回车，不填写</span></span></code></pre></div><h3 id="_3-2-2-带san扩展的证书请求" tabindex="-1">3.2.2 带SAN扩展的证书请求 <a class="header-anchor" href="#_3-2-2-带san扩展的证书请求" aria-label="Permalink to &quot;3.2.2 带SAN扩展的证书请求&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/pki/tls/openssl.cnf /tmp</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp/openssl.cnf</span></span></code></pre></div><p>此文件的格式是类似 <code>ini</code> 的配置文件格式，找到 <strong>[ req ]</strong> 段落，加上下面的配置：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">req_extetions</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> = v3_req</span></span></code></pre></div><p>这段配置表示在生成 CSR 文件时读取名叫 <code>v3_req</code> 的段落的配置信息，因此我们再在此配置文件中加入一段名为 <code>v3_req</code> 的配置</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ v3_req ]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Extensions to add to a certificate request</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">basicConstraints</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> = CA:FALSE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">keyUsage</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> = nonRepudiation, digitalSignature, keyEncipherment</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">subjectAltName</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> = @alt_names</span></span></code></pre></div><p>这段配置中最重要的是在最后导入名为 <code>alt_names</code> 的配置段，因此我们还需要添加一个名为 <code>[ alt_names ]</code> 的配置段：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ alt_names ]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DNS.1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> = hub.kuber.com</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IP.1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">192.168</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.66.200</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ alt_names ]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IP.1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">172.18</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.128.36</span></span></code></pre></div><p>这里填入需要加入到 Subject Alternative Names 段落中的域名名称，可以写入多个。</p><p>接着使用这个临时配置生成证书请求：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> req -new -nodes -keyout server.key -out server.csr -config /tmp/openssl.cnf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> req -new -nodes -keyout server.key -out server.csr -config openssl.cnf</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Generating</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2048</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bit RSA private key</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">....</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+++</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">.................................</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+++</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">writing</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> new private key to &#39;server.key&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-----</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">You</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> are about to be asked to enter information that will be incorporated</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">into</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> your certificate request.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">What</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> you are about to enter is what is called a Distinguished Name or a DN.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">There</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> are quite a few fields but you can leave some blank</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">For</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> some fields there will be a default value,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">If</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> you enter &#39;.&#39;, the field will be left blank.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-----</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Country</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> letter code</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) [XX]:CN</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">State</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> or Province Name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">full</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) []:BEIJING</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Locality</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eg,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> city</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) [Default </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">City]:BEIJING</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Organization</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eg,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> company</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) [Default </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Company Ltd]:CC</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Organizational</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Unit Name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eg,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> section</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) []:OPT</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Common</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eg,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> your name or your server&#39;s hostname) []:www.rancho.com</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Email Address []:planet1991@163.com</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Please enter the following &#39;extra&#39; attributes</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">to be sent with your certificate request</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">A challenge password []:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">An optional company name []:</span></span></code></pre></div><p>查看证书请求文件的内容：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> req -text -noout -in server.csr</span></span></code></pre></div><p>可以看到此证书请求文件中会包含 Subject Alternative Names 字段，并包含之前在配置文件中填写的域名。</p><h2 id="_3-3-使用ca证书签发证书" tabindex="-1">3.3 使用CA证书签发证书 <a class="header-anchor" href="#_3-3-使用ca证书签发证书" aria-label="Permalink to &quot;3.3 使用CA证书签发证书&quot;">​</a></h2><p>使用CA机器签发证书</p><h3 id="_3-3-1-普通证书" tabindex="-1">3.3.1 普通证书 <a class="header-anchor" href="#_3-3-1-普通证书" aria-label="Permalink to &quot;3.3.1 普通证书&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ca -in server.csr  -days </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">365</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  -out server.crt</span></span></code></pre></div><h3 id="_3-3-2-带san扩展的证书" tabindex="-1">3.3.2 带SAN扩展的证书 <a class="header-anchor" href="#_3-3-2-带san扩展的证书" aria-label="Permalink to &quot;3.3.2 带SAN扩展的证书&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 将 /tmp/openssl.cnf  server.csr 复制到CA机器</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ca -policy policy_anything -out server.crt -config /tmp/openssl.cnf -extensions v3_req -infiles server.csr</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ca -policy policy_anything -out server.crt -config openssl.cnf -extensions v3_req -infiles server.csr</span></span></code></pre></div><h1 id="_4-将私钥和签发的证书配置到服务器" tabindex="-1">4. 将私钥和签发的证书配置到服务器 <a class="header-anchor" href="#_4-将私钥和签发的证书配置到服务器" aria-label="Permalink to &quot;4. 将私钥和签发的证书配置到服务器&quot;">​</a></h1><h1 id="附录-openssl-san证书" tabindex="-1">附录：OpenSSL SAN证书 <a class="header-anchor" href="#附录-openssl-san证书" aria-label="Permalink to &quot;附录：OpenSSL SAN证书&quot;">​</a></h1><h2 id="什么是san" tabindex="-1">什么是SAN <a class="header-anchor" href="#什么是san" aria-label="Permalink to &quot;什么是SAN&quot;">​</a></h2><ul><li><p>SAN(Subject Alternative Name) 是 <a href="https://so.csdn.net/so/search?q=SSL&amp;spm=1001.2101.3001.7020" target="_blank" rel="noreferrer">SSL</a> 标准 x509 中定义的一个扩展。使用了 SAN 字段的 SSL 证书，可以扩展此证书支持的域名，使得一个证书可以支持多个不同域名的解析。</p></li><li><p>先来看一看 Google 是怎样使用 SAN 证书的，下面是 Youtube 网站的证书信息：</p><p>![1](F:\\article\\images\\Openssl SAN证书\\1.png)</p></li><li><p>这里可以看到这张证书的 Common Name 字段是 *.google.com，那么为什么这张证书却能够被 www.youtube.com</p></li><li><p>这个域名所使用呢。原因就是这是一张带有 SAN 扩展的证书，下面是这张证书的 SAN 扩展信息：![2](F:\\article\\images\\Openssl SAN证书\\2.png)</p></li><li><p>这里可以看到，这张证书的 Subject Alternative Name 段中列了一大串的域名，因此这张证书能够被多个域名所使用。对于 Google 这种域名数量较多的公司来说，使用这种类型的证书能够极大的简化网站证书的管理。</p></li></ul>`,57),h=[t];function p(k,r,d,F,o,c){return a(),i("div",null,h)}const C=s(l,[["render",p]]);export{y as __pageData,C as default};
